<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>API Client 테스트</title>
</head>
<body>
<h1>API Client 테스트</h1>

<button onclick="testGet()">GET 테스트</button>
<button onclick="testPost()">POST 테스트</button>
<button onclick="testError()">에러 테스트</button>

<h3>요청</h3>
<pre id="request">-</pre>

<h3>응답</h3>
<pre id="result">-</pre>

<script src="/js/api-client/core/ApiClient.js"></script>
<script>
    // =============================================
    // 1. 클라이언트 생성
    // =============================================
    const api = new ApiClient({
        baseURL: '/api',
        timeout: 5000,
        retry: { count: 0, delay: 1000 },

        onRequest: (config) => console.log('[onRequest]', config.method, config.url),
        onResponse: (result) => console.log('[onResponse]', result.success),
        onSuccess: (result) => console.log('[onSuccess]', result.data),
        onError: (error) => console.log('[onError]', error.error?.code, error.error?.message),
        onFinally: () => console.log('[onFinally]')
    });

    // =============================================
    // 2. 요청 예시
    // =============================================

    // GET 요청
    async function testGet() {
        const method = 'GET';
        const url = '/example/simple';
        const body = null;

        showRequest(method, url, body);

        try {
            const result = await api.request(method, url);
            document.getElementById('result').textContent = JSON.stringify(result, null, 2);
        } catch (error) {
            document.getElementById('result').textContent = JSON.stringify(error, null, 2);
        }
    }

    // POST 요청
    async function testPost() {
        const method = 'POST';
        const url = '/example/echo';
        const body = { name: '테스트', value: 123 };

        showRequest(method, url, body);

        try {
            const result = await api.request(method, url, { body });
            document.getElementById('result').textContent = JSON.stringify(result, null, 2);
        } catch (error) {
            document.getElementById('result').textContent = JSON.stringify(error, null, 2);
        }
    }

    // 에러 응답 테스트
    async function testError() {
        const method = 'GET';
        const url = '/example/error/notfound';
        const body = null;

        showRequest(method, url, body);

        try {
            const result = await api.request(method, url);
            document.getElementById('result').textContent = JSON.stringify(result, null, 2);
        } catch (error) {
            document.getElementById('result').textContent = JSON.stringify(error, null, 2);
        }
    }

    // 요청 정보 표시
    function showRequest(method, url, body) {
        const req = {
            method: method,
            url: api.baseURL + url,
            body: body
        };
        document.getElementById('request').textContent = JSON.stringify(req, null, 2);
    }

    // then 방식 (일반 함수에서 사용할 때)
    // function testThen() {
    //     api.request('GET', '/example/simple')
    //         .then(result => console.log(result))
    //         .catch(error => console.log(error));
    // }
</script>
</body>
</html>
